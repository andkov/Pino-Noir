{
    "contents" : "options(width=160)\nrm( list = setdiff(ls(),c(\"data\",\"labels\")))\ncat(\"\\f\")\n\n## @knitr load_packages\nlibrary(dplyr)\nlibrary(ggplot2)\n\n## @knitr load_data\n# data <- readRDS(\"./data.rds\")\nsource(\"./0_enter_data.R\")\n\n## @knitr tweak_data\n\ndata <- data\nstr(data)\ndata$value <- as.numeric(data$value)-1\ndata$valueTF <- as.logical(data$value)\nhead(data)\n\n\n\n# res$label2\n# print(res, n=nrow(res))\n\n## @knitr define_themes\nbaseSize <- 12\ntheme1 <- ggplot2::theme_bw(base_size=baseSize) +\n  ggplot2::theme(title=ggplot2::element_text(colour=\"gray20\",size = baseSize+1)) +\n  ggplot2::theme(axis.text=ggplot2::element_text(colour=\"gray40\", size=baseSize-2)) +\n  ggplot2::theme(axis.title=ggplot2::element_text(colour=\"gray40\")) +\n  ggplot2::theme(panel.border = ggplot2::element_rect(colour=\"gray80\")) +\n  ggplot2::theme(axis.ticks.length = grid::unit(0, \"cm\")) +\n  ggplot2::theme(text = element_text(size =baseSize+7)) \n\n## @knitr counts\nds <- data %>%\n  dplyr::group_by(wine, region, year) %>%\n  summarize(count=n_distinct(.id))\nprint(ds, n=nrow(ds))\n\nds <- data %>%\n  dplyr::group_by(wine, person) %>%\n  summarize(count=n_distinct(.id))\nt <- table(ds$wine, ds$person)\nt[t==0] <- \".\"\nt\n\n\n\n## @knitr likability\nds <- data %>% dplyr::select(person, wine, region, year, like) %>%\n  dplyr::group_by(person, wine, region, year) %>%\n  dplyr::summarize(like=mean(like)) %>%\n  dplyr::arrange(person,wine)\nds <- ds %>% dplyr::group_by(wine, region) %>%\n  dplyr::summarize(like=mean(like)) \nds$like <- round(ds$like,2)\n\ng <- ggplot2::ggplot(ds, aes(x=wine,y=like, fill=region))\ng <- g + geom_bar(stat=\"identity\")\n# g <- g + scale_y_discrete(limits=rev(labels))\ng <- g + labs(title=\"Average likability across raters\", x=\"Wine\", y=\"Average likability\")\n# g <- g + facet_grid(.~sense)\n# g <- g + scale_fill_gradient(low=\"white\", high=\"red\")\ng <- g + geom_text(aes(label=like), vjust=1.5 )\ng <- g + theme1\n# g <- g + theme(axis.title.y = element_blank())\ng\n\n\n\n## @knitr summary_heat\nds <- data\nres <- ds %>% dplyr::group_by(wine,label, sense) %>%\n  dplyr::summarize(score=mean(value))\nres$score <- round(res$score,2)\n##\n\ng <- ggplot2::ggplot(res, aes(x=wine,y=label, fill=score))\ng <- g + geom_tile()\ng <- g + scale_y_discrete(limits=rev(labels))\ng <- g + labs(title=\"Average scores across raters \", x=\"Wine\")\ng <- g + facet_grid(.~sense)\ng <- g + scale_fill_gradient(low=\"white\", high=\"red\")\ng <- g + geom_text(aes(label=score))\ng <- g + theme1\ng <- g + theme(axis.title.y = element_blank())\ng\n\n# ## @knitr aroma_heat\n# ds <- data[data$sense==\"aroma\",]\n# res <- ds %>%  \n#   dplyr::group_by(wine,label) %>%\n#   dplyr::summarize(score=mean(value))\n# g <- ggplot2::ggplot(res, aes(x=wine,y=label, fill=score))\n# g <- g + geom_tile()\n# g <- g + scale_y_discrete(limits=rev(labels))\n# g <- g + labs(title=\"Summary scores across raters\", x=\"Wine\")\n# # g <- g + facet_grid(.~sense)\n# g <- g + scale_fill_gradient(low=\"white\", high=\"red\")\n# g <- g + geom_text(aes(label=score))\n# g <- g + theme1\n# g <- g + theme(axis.title.y = element_blank())\n# g\n# \n# ## @knitr flavour_heat\n# ds <- data[data$sense==\"flavour\",]\n# res <- ds %>%  \n#   dplyr::group_by(wine,label) %>%\n#   dplyr::summarize(score=mean(value))\n# g <- ggplot2::ggplot(res, aes(x=wine,y=label, fill=score))\n# g <- g + geom_tile()\n# g <- g + scale_y_discrete(limits=rev(labels))\n# g <- g + labs(title=\"Summary scores across raters\", x=\"Wine\")\n# # g <- g + facet_grid(.~sense)\n# g <- g + scale_fill_gradient(low=\"white\", high=\"red\")\n# g <- g + geom_text(aes(label=score))\n# g <- g + theme1\n# g <- g + theme(axis.title.y = element_blank())\n# g\n\n## @knitr both_heat\nds <- data\nres <- ds %>%  \n  dplyr::group_by(wine,label) %>%\n  dplyr::summarize(score=mean(value))\nres$score <- round(res$score,2)\n\ng <- ggplot2::ggplot(res, aes(x=wine,y=label, fill=score))\ng <- g + geom_tile()\ng <- g + scale_y_discrete(limits=rev(labels))\ng <- g + labs(title=\"Average scores across raters (both aromas and flavours)\", x=\"Wine\")\n# g <- g + facet_grid(.~sense)\ng <- g + scale_fill_gradient(low=\"white\", high=\"red\")\ng <- g + geom_text(aes(label=score))\ng <- g + theme1\ng <- g + theme(axis.title.y = element_blank())\ng\n# table(ds$valueTF, ds$wine)\n\n\n\n\n",
    "created" : 1433018300371.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "742228175",
    "id" : "4D172FD9",
    "lastKnownWriteTime" : 1433043597,
    "path" : "~/GitHub/Pinot-Noir/1_graph_data.R",
    "project_path" : "1_graph_data.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}